<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cykj.hospitalsystem.mapper.RolepowerMapper">
    <update id="setAuthority">
        update tblrolepower set state=1
        where roleid=#{map.roleid} and menuid in
        <foreach item="item" index="index" collection="map.treeArray" open="(" separator="," close=")">
            #{item}
        </foreach>
    </update>
    <update id="setAuthorityNot">
        update tblrolepower set state=0
        where roleid=#{map.roleid} and menuid not in
        <foreach item="item" index="index" collection="map.treeArray" open="(" separator="," close=")">
            #{item}
        </foreach>
    </update>
    <insert id="addNewData">
        insert into tblrolepower(menuid,roleid,state) values
        <foreach collection="map.RoutesList" item="routes" separator=",">
            (#{routes.rid},
            #{map.roleid},
            0)
        </foreach>
    </insert>
    <select id="byRoleidGetmenuid" parameterType="String" resultType="Tblrolepower">
        select menuid from tblrolepower where roleid=#{roleid} and state=1
    </select>
    <select id="byRoleidListGetmenuid" parameterType="String" resultType="Tblrolepower">
        select trp.menuid from tblrolepower trp where trp.state = 1  and  trp.roleid in(
select tsr.roleid from tblstaffRole tsr where tsr.staffid = #{accid}) GROUP BY trp.menuid
    </select>
    <select id="getMenuIdByRoleId" parameterType="Map" resultType="java.lang.Integer">
        select menuid from tblrolepower
        <where>
            <if test="roleid!=null and roleid!=''">
                roleid=#{roleid}
            </if>
            <if test="state!=null and state!=''">
                and state = #{state}
            </if>
        </where>
    </select>

</mapper>
